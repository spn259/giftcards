<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Encuesta · Experiencia</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    /* ---------- Full-viewport layout ---------- */
    html,body{height:100%;width:100%;margin:0;}
    body{display:flex;flex-direction:column;background:#f8f9fa;}

    .survey-wrapper{
      flex:1 1 0;width:96vw;max-width:1400px;margin:auto;
      padding:2rem 1rem;display:flex;flex-direction:column;justify-content:center;
    }

    /* ---------- Cards ---------- */
    .survey-row{
      padding:2rem 2.2rem;font-size:1.35rem;
      display:flex;align-items:center;justify-content:space-between;
      background:#fff;border-radius:1.5rem;
      box-shadow:0 .5rem 1.25rem -.3rem rgb(0 0 0 / .15);
      margin-bottom:2rem;
    }
    .category-icon{font-size:2.25rem;opacity:.85;}

    /* ---------- Rating buttons ---------- */
    .emoji-btn{
      font-size:clamp(3.75rem,7vw,5.5rem);
      cursor:pointer;padding:.4rem;border-radius:50%;
      transition:transform .2s,box-shadow .2s,background-color .2s;
    }
    .emoji-btn[data-val="1"]{color:#dc3545;}
    .emoji-btn[data-val="2"]{color:#ffc107;}
    .emoji-btn[data-val="3"]{color:#198754;}
    .emoji-btn:hover   {transform:translateY(-6px) scale(1.1);}
    .emoji-btn.active{
      transform:scale(1.22);background:rgba(0,0,0,.05);
      box-shadow:0 0 0 .35rem currentColor inset,
                 0 .65rem 1rem -.35rem rgb(0 0 0 / .25);
    }

    .toast{font-size:1.15rem;}

    /* ---------- Full-screen prompt ---------- */
    #fsBtn{
      position:fixed;bottom:2.5rem;left:50%;translate:-50% 0;
      z-index:1200;display:none;
      padding:.75rem 1.5rem;border:none;border-radius:999px;
      background:#0d6efd;color:#fff;font-size:1rem;font-weight:600;
      box-shadow:0 .4rem 1rem -.25rem rgb(0 0 0 / .3);
      transition:opacity .2s;
    }
    #fsBtn:hover{background:#0b5ed7;}
    #fsBtn.hide{opacity:0;pointer-events:none;}

    @media (min-width:768px){
      .survey-row   {padding:2.4rem 3rem;font-size:1.6rem;}
      .category-icon{font-size:2.5rem;}
    }
  </style>
</head>

<body>
  <!-- Full-screen button -->
  <button id="fsBtn">Pantalla completa&nbsp;↗︎</button>

  <div class="survey-wrapper fade-page">
    <h1 class="text-center mb-4 fw-bold display-5">Valora tu experiencia</h1>

    <!-- Survey grid -->
    <form id="survey" class="w-100">
      <template id="rowTpl">
        <div class="survey-row">
          <span class="d-flex align-items-center flex-grow-1 fw-semibold text-capitalize">
            <i class="bi category-icon me-3"></i>
            <span class="label-text"></span>
          </span>

          <div class="d-flex gap-5">
            <i class="bi bi-emoji-frown   emoji-btn" data-val="1"></i>
            <i class="bi bi-emoji-neutral emoji-btn" data-val="2"></i>
            <i class="bi bi-emoji-smile   emoji-btn" data-val="3"></i>
          </div>
          <input type="hidden" name="" />
        </div>
      </template>
    </form>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-4" style="z-index:1100">
    <div id="toastFeed" class="toast align-items-center text-bg-success border-0" role="alert">
      <div class="d-flex">
        <div class="toast-body fw-semibold">Gracias por tu feedback 🎉</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /* ---------- Full-screen helper ---------- */
    function goFullscreen(){
      const el=document.documentElement;
      if(el.requestFullscreen)      el.requestFullscreen();
      else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if(el.mozRequestFullScreen)    el.mozRequestFullScreen();
      else if(el.msRequestFullscreen)     el.msRequestFullscreen();
    }

    /* ---------- Prompt on load ---------- */
    window.addEventListener("DOMContentLoaded",() =>{
      const fsBtn=document.getElementById("fsBtn");
      fsBtn.style.display="block";
      fsBtn.addEventListener("click",() => {
        goFullscreen();
        fsBtn.classList.add("hide");
      });
      document.addEventListener("fullscreenchange",() => {
        if(!document.fullscreenElement) fsBtn.classList.remove("hide");
      });
    });

    /* ---------- Survey logic ---------- */
    (() => {
      const areas=["comida","servicio","limpieza"];
      const icons={servicio:"bi-bell",limpieza:"bi-bucket"};
      const survey=document.getElementById("survey");
      const tpl=document.getElementById("rowTpl").content;

      areas.forEach(a=>{
        const row=tpl.cloneNode(true);
        row.querySelector(".label-text").textContent=a;
        const ic=row.querySelector(".category-icon");
        if(a==="comida"){ic.classList.remove("bi");ic.textContent="🍩";}
        else            {ic.classList.add(icons[a]);}
        row.querySelector("input").name=a;
        row.querySelectorAll(".emoji-btn").forEach(b=>b.onclick=()=>select(b));
        survey.appendChild(row);
      });

      const val=a=>survey.elements[a].value;
      const done=()=>areas.every(a=>val(a));

      function select(btn){
        const before=done();
        const row=btn.closest(".survey-row");
        row.querySelectorAll(".emoji-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        row.querySelector("input").value=btn.dataset.val;
        if(!before && done()) submit();
      }

      const toast=new bootstrap.Toast(document.getElementById("toastFeed"));

      async function submit(){
        const payload=Object.fromEntries(areas.map(a=>[a,val(a)]));
        try{
          await fetch("/survey/submit",{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify(payload)
          });
          toast.show();
        }catch{ alert("Error al enviar."); }
        finally{ reset(); }
      }

      function reset(){
        survey.querySelectorAll(".emoji-btn").forEach(b=>b.classList.remove("active"));
        survey.reset();
      }
    })();
  </script>
</body>
</html>
